<!DOCTYPE html>
<html lang="en">

<head>
<%- include('includes/head') %>

</head>
<body>
    <!-- All Destinations Page -->

<%- include('includes/header') %>

    <div id="all-destinations-page">
        <section class="destinations-hero">
            <div class="hero-content">
                <h1>Discover Tabuk</h1>
                <p>Explore the breathtaking destinations of our mountain province through immersive virtual tours</p>
            </div>
        </section>
        


        <section class="all-destinations">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center mb-5">
                        <h1 class="section-title">Explore Tabuk</h1>
                        <p class="text-muted">Discover the breathtaking destinations of Kalinga</p>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-8 mx-auto">
                        <div class="search-bar">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search destinations..." id="search-input">
                              
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="search-results-count" id="results-count"></p>
                    </div>
                </div>
                
                <div class="row" id="destinations-container">
                    <!-- Destination cards will be loaded here by JavaScript -->
                </div>
                
                <div class="row mt-5">
                    <div class="col-12 text-center">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center" id="pagination">
                                <!-- Pagination will be generated by JavaScript -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <%- include('includes/footer') %>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Destination data
            const destinations = <%- JSON.stringify(tours) %>;

            // Pagination variables
            const itemsPerPage = 6;
            let currentPage = 1;
            let filteredDestinations = [...destinations];
            let searchTimeout;

            // DOM elements
            const container = document.getElementById('destinations-container');
            const pagination = document.getElementById('pagination');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const resultsCount = document.getElementById('results-count');

            // Initialize the page
            renderDestinations();
            renderPagination();
            updateResultsCount();

            // Search functionality - automatic on input with debounce
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch();
                }, 300); // 300ms debounce delay
            });

            // Also search on button click
            searchButton.addEventListener('click', performSearch);

            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    filteredDestinations = [...destinations];
                } else {
                    filteredDestinations = destinations.filter(dest => {
                        return (
                            dest.name.toLowerCase().includes(searchTerm) ||
                            dest.fullDescription.toLowerCase().includes(searchTerm) ||
                            dest.features.some(feat => feat.toLowerCase().includes(searchTerm))
                        );
                    });
                }
                
                currentPage = 1;
                renderDestinations();
                renderPagination();
                updateResultsCount();
                
                // Show no results message if needed
                const noResultsElement = document.getElementById('no-results-message');
                if (filteredDestinations.length === 0 && searchTerm !== '') {
                    if (!noResultsElement) {
                        const noResultsDiv = document.createElement('div');
                        noResultsDiv.id = 'no-results-message';
                        noResultsDiv.className = 'col-12 text-center my-5';
                        noResultsDiv.innerHTML = `
                            <h4>No destinations found matching "${searchTerm}"</h4>
                            <p>Try different keywords like "hiking", "culture", or "scenic"</p>
                            <button class="btn btn-explore mt-3" id="reset-search">Show All Destinations</button>
                        `;
                        container.parentNode.insertBefore(noResultsDiv, container.nextSibling);
                        
                        document.getElementById('reset-search').addEventListener('click', function() {
                            searchInput.value = '';
                            filteredDestinations = [...destinations];
                            currentPage = 1;
                            renderDestinations();
                            renderPagination();
                            updateResultsCount();
                            noResultsDiv.remove();
                        });
                    }
                } else if (noResultsElement) {
                    noResultsElement.remove();
                }
            }

            function updateResultsCount() {
                const count = filteredDestinations.length;
                if (count === destinations.length) {
                    resultsCount.textContent = `Showing all ${count} destinations`;
                } else if (count === 0) {
                    resultsCount.textContent = '';
                } else {
                    resultsCount.textContent = `Found ${count} ${count === 1 ? 'destination' : 'destinations'}`;
                }
            }

            function renderDestinations() {
                container.innerHTML = '';
                
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const paginatedItems = filteredDestinations.slice(startIndex, endIndex);
                
                if (paginatedItems.length === 0) {
                    container.innerHTML = `
                        <div class="col-12 text-center my-5">
                            <h4>No destinations found</h4>
                        </div>
                    `;
                    return;
                }
                
                paginatedItems.forEach(dest => {
                    const features = dest.features.map(feat => 
                        `<span class="destination-feature">${feat}</span>`
                    ).join('');
                    
                    const card = document.createElement('div');
                    card.className = 'col-lg-4 col-md-6';
                    card.innerHTML = `
                        <div class="destination-card">
                            <img src="${dest.image}" class="destination-card-img" alt="${dest.name}">
                            
                            <div class="destination-card-overlay">
                                <div class="destination-card-content">
                                    <h3 class="destination-card-title">${dest.name}</h3>
                                </div>
                            </div>
                            
                            <div class="destination-card-hover">
                                <h3 class="destination-card-title">${dest.name}</h3>
                                <p class="mb-3">${dest.fullDescription}</p>
                                <div class="destination-features">
                                    ${features}
                                </div>
                                <a href="/full-details" class="btn btn-explore mt-3">Explore</a>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            function renderPagination() {
                pagination.innerHTML = '';
                
                const pageCount = Math.ceil(filteredDestinations.length / itemsPerPage);
                if (pageCount <= 1) return;
                
                // Previous button
                const prevLi = document.createElement('li');
                prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
                prevLi.innerHTML = `<a class="page-link" href="#" tabindex="-1"><i class="fas fa-chevron-left"></i></a>`;
                prevLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentPage > 1) {
                        currentPage--;
                        renderDestinations();
                        renderPagination();
                        window.scrollTo({top: container.offsetTop - 100, behavior: 'smooth'});
                    }
                });
                pagination.appendChild(prevLi);
                
                // Page numbers
                const maxVisiblePages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages/2));
                let endPage = Math.min(pageCount, startPage + maxVisiblePages - 1);
                
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }
                
                if (startPage > 1) {
                    const li = document.createElement('li');
                    li.className = 'page-item';
                    li.innerHTML = `<a class="page-link" href="#">1</a>`;
                    li.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentPage = 1;
                        renderDestinations();
                        renderPagination();
                        window.scrollTo({top: container.offsetTop - 100, behavior: 'smooth'});
                    });
                    pagination.appendChild(li);
                    
                    if (startPage > 2) {
                        const dots = document.createElement('li');
                        dots.className = 'page-item disabled';
                        dots.innerHTML = `<span class="page-link">...</span>`;
                        pagination.appendChild(dots);
                    }
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                    li.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentPage = i;
                        renderDestinations();
                        renderPagination();
                        window.scrollTo({top: container.offsetTop - 100, behavior: 'smooth'});
                    });
                    pagination.appendChild(li);
                }
                
                if (endPage < pageCount) {
                    if (endPage < pageCount - 1) {
                        const dots = document.createElement('li');
                        dots.className = 'page-item disabled';
                        dots.innerHTML = `<span class="page-link">...</span>`;
                        pagination.appendChild(dots);
                    }
                    
                    const li = document.createElement('li');
                    li.className = 'page-item';
                    li.innerHTML = `<a class="page-link" href="#">${pageCount}</a>`;
                    li.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentPage = pageCount;
                        renderDestinations();
                        renderPagination();
                        window.scrollTo({top: container.offsetTop - 100, behavior: 'smooth'});
                    });
                    pagination.appendChild(li);
                }
                
                // Next button
                const nextLi = document.createElement('li');
                nextLi.className = `page-item ${currentPage === pageCount ? 'disabled' : ''}`;
                nextLi.innerHTML = `<a class="page-link" href="#"><i class="fas fa-chevron-right"></i></a>`;
                nextLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentPage < pageCount) {
                        currentPage++;
                        renderDestinations();
                        renderPagination();
                        window.scrollTo({top: container.offsetTop - 100, behavior: 'smooth'});
                    }
                });
                pagination.appendChild(nextLi);
            }
        });
    </script>
</body>
</html>